<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/basic.css">
    <link rel="stylesheet" href="../css/font.css">
    <link rel="stylesheet" href="../css/question.css">
    <title>question_25</title>
</head>
<body>
    <header>
        <img src="../images/back.png" alt="fail" class="back">
        <a href="../pages/home.html"><p class="text-Poppins20">Number</p></a>
        <a href="../pages/homeABC.html"><p class="text-Poppins20">ABC</p></a>
    </header>
    <main>
        <p class="text-Poppins13">По умолчанию SQL Server работает в режиме автоматического начала транзакций. В этом режиме каждая команда рассматривается как отдельная транзакция. Пользователю не нужно явно указывать начало и конец транзакции, так как это за него делает SQL Server. Если команда выполнена успешно, то сделанные ею изменения фиксируются. Если же при выполнении команды произошла ошибка, то сделанные изменения отменяются и система возвращается в первоначальное состояние.</p>
        <p class="text-Poppins13">Если пользователю необходимо создать транзакцию, включающую несколько команд, то он должен явно указать транзакцию.</p>
        <p class="text-Poppins13">Вообще сервер работает только в одном из двух режимов определения транзакции: автоматическом или подразумевающемся. Сервер не может находиться в режиме исключительно явного определения транзакций. Этот режим работает поверх двух других.</p>
        <p class="text-Poppins13">Для установки режима автоматического определения транзакций используется следующая команда Transact-SQL:</p>
        <pre class="code">SET IMPLICIT_TRANSACTION OFF</pre>
        <p class="text-Poppins13"><span>Вложенными транзакциями</span> называются транзакции, выполнение которых инициируется из тела уже активной транзакции.</p>
        <p class="text-Poppins13">Как правило, вложенные транзакции используют в ситуации, когда нужно реализовать выполнение хранимой процедуры в рамках уже активной транзакции. Пользователь может обращаться к хранимой процедуре как из уже начатой транзакции, так и непосредственно (не из тела транзакции). Сервер должен гарантировать целостность данных и соблюдение требования ACID в обоих случаях. Использование вложенных транзакций доступно только при работе с явными транзакциями.</p>
        <p class="text-Poppins13">При использовании автоматических или подразумевающихся транзакций перед началом новой транзакции предыдущая транзакция должна быть завершена. Поэтому эти два вида транзакций не могут использовать вложенные транзакции.</p>
        <p class="text-Poppins13">Для создания вложенной транзакции пользователю не нужно использовать какие-либо дополнительные команды. Он просто начинает новую транзакцию, не закрыв предыдущую. Завершение транзакций верхнего уровня откладывается до завершения вложенных транзакций. Если транзакция самого нижнего (вложенного) уровня завершена неудачно и откачена, то все транзакции верхнего уровня, включая транзакцию первого уровня, будут откачены.</p>
        <p class="text-Poppins13">Для отката вложенной транзакции используется команда ROLLBACK TRANSACTION с указанием имени последней начатой транзакции. Если в команде ROLLBACK TRANSACTION указывается имя транзакции более высокого уровня, то происходит откат всех вложенных транзакций включительно до уровня транзакции, имя которой было указано при запуске команды. Если команда ROLLBACK TRANSACTION используется на любом уровне вложенности без указания имени транзакции или же используется команда ROLLBACK WORK, то откатываются все вложенные транзакции, включая транзакцию самого высокого (первого) уровня.</p>
        <p class="text-Poppins13"><span>Недопустимые в транзакциях операторы:</span></p>
        <p class="text-Poppins13 list">– DDL операторы (Data Definition Language): CREATE, ALTER и DROP, считаются недопустимыми в транзакциях, поскольку они изменяют структуру базы данных. Это может привести к непредсказуемым результатам, если транзакция будет отменена.</p>
        <p class="text-Poppins13 list">– операторы TRUNCATE и DELETE без условия WHERE;</p>
        <p class="text-Poppins13 list">– CONNECT, DISCONNECT, SET CONNECTION;</p>
        <p class="text-Poppins13 list">– BACKUP и RESTORE;</p>
        <p class="text-Poppins13 list">– операторы управления курсорами;</p>
        <p class="text-Poppins13 list">– GRANT и REVOKE (лучше вне транзакции);</p>
        <p class="text-Poppins13 list">– COMMIT и ROLLBACK (лучше на верхних уровнях).</p>
    </main>
    <footer>

    </footer>
</body>
<script src="../js/back.js"></script>
</html>