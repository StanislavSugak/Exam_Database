<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/basic.css">
    <link rel="stylesheet" href="../css/font.css">
    <link rel="stylesheet" href="../css/question.css">
    <title>question_33</title>
</head>
<body>
    <header>
        <img src="../images/back.png" alt="fail" class="back">
        <a href="../pages/home.html"><p class="text-Poppins20">Number</p></a>
        <a href="../pages/homeABC.html"><p class="text-Poppins20">ABC</p></a>
    </header>
    <main>
        <p class="text-Poppins13"><span>Репликация моментальных снимков</span> – это самый простой вид репликации. Моментальный снимок (snapshot) представляет собой полную копию данных, выбранных для репликации. При использовании репликации моментальных снимков полная копия тиражируемых данных рассылается всем подписчикам. Этот тип репликации характеризуется малой загрузкой процессора, так как нет необходимости в анализе таблиц для отбора новых или измененных данных. Недостатком является значительная загрузка сети при работе с большими базами данных. При внесении даже небольшого количества изменений будут передаваться все данные, включенные в репликацию.</p>
        <p class="text-Poppins13">Репликация моментальных снимков гарантирует согласованность данных между издателем и подписчиком. Так как этот тип репликации требует наличия мощного канала для передачи данных, Snapshot Replication часто используется для копирования редко обновляемых данных, «свежесть» которых не актуальна. </p>
        <p class="text-Poppins13"><span>Репликация моментальных снимков выполняется двумя агентами:</span></p>
        <p class="text-Poppins13 list">– Snapshot Agent. Каждый раз, когда запускается Snapshot Agent, он подготавливает файл данных моментального снимка (snapshot file), который впоследствии будет копироваться подписчикам.</p>
        <p class="text-Poppins13 list">– Distribution Agent. После того как агент Snapshot Agent завершит свою работу, на дистрибьюторе будет находиться вся информация, необходимая для создания на подписчиках копий статей издателя. Перед Distribution Agent стоит задача доставить подписчикам данные, подготовленные Snapshot Agent.</p>
        <p class="text-Poppins13">Когда в сети имеется множество подписчиков, использование репликации по запросу может снизить нагрузку на дистрибьютора и тем самым повысить производительность. Distribution Agent в таком случае запускается на подписчике. Периодически запускаются задачи (Agent checkup; Transaction cleanup; History cleanup).</p>
        <p class="text-Poppins13"><span>Безотлагательное обновление при репликации моментальных снимков. </span>Самая простая схема репликации моментальных снимков имеет однонаправленное действие – от издателя к подписчику. Все изменения должны выполняться на издателе, а затем копироваться подписчикам. В SQL Server была выедена новая технология – подписчики незамедлительного обновления. Это позволило расширить возможности репликации моментальных снимков, разрешив подписчикам изменять данные. </p>
        <p class="text-Poppins13">Использование подписчиков незамедлительного обновления обеспечивает скрытую согласованность транзакций, выполняемых одним из подписчиков, между всеми участниками репликации. Когда подписчик изменяет локальные данные, вносимые нм изменения немедленно отображаются на издателе и затем копируются всем остальным подписчикам. Для этого используется двухфазный протокол изменений (2РС), управляемый координатором распределенных транзакций (Microsoft Distributed Transactional Coordinator – MS DTC). Когда подписчик пытается изменить данные, с помощью протокола 2РС создается распределенная транзакция, в которой данные одновременно изменяются на подписчике и издателе. Если по каким-то причинам данные на издателе не могут быть изменены, вся транзакция отменяется, и данные на подписчике остаются неизмененными. Если изменения с использованием протокола 2РС были успешно выполнены, измененные данные распространяются с помощью дистрибьютора всем остальным подписчикам по установленному расписанию или по требованию.</p>
        <p class="text-Poppins13">Подписчик, который выполнял изменения, может успешно работать, не дожидаясь, пока новые данные будут ему скопированы. Целостность данных в этом случае не нарушается.</p>
        <p class="text-Poppins13"><span>Репликация транзакций</span> может быть использована для копирования объектов двух различных типов: таблиц или хранимых процедур. Вся таблица или ее часть может быть включена в публикацию как статья. Кроме того, в эту же или другую публикацию в качестве статьи может быть также включена одна или несколько хранимых процедур.</p>
        <p class="text-Poppins13">Репликация транзакций использует журнал транзакций базы данных, из которого собирается информация о выполняемых в выбранной для публикации таблице командах UPDATE, INSERT, DELETE и других изменениях. Выбранные транзакции копируются в базу данных дистрибьютора с сохранением информации о последовательности их выполнения. Затем эти транзакции рассылаются подписчикам и применяются из них в том же порядке, в котором они происходили на издателе.</p>
        <p class="text-Poppins13">Сделанные на издателе изменения передаются подписчикам постоянно или с определенными интервалами. Обычно изменения отображаются на всех участниках репликации в реальном времени или с задержкой в несколько секунд. При выполнении репликации транзакций исключаются конфликты обновления, так как все изменения выполняются на издателе. </p>
        <p class="text-Poppins13"><span>При использовании репликации транзакций задействованы три агента:</span></p>
        <p class="text-Poppins13 list">- Snapshot Agent;</p>
        <p class="text-Poppins13 list">- Log Reader Agent;</p>
        <p class="text-Poppins13 list">- Distribution Agent.</p>
        <p class="text-Poppins13">Перед тем как транзакции начнут применяться на подписчике, необходимо выполнить первоначальную синхронизацию данных издателя и подписчика Snapshot Agent выполняет копирование всех данных, находящихся в созданных статьях. При этом используются механизмы, обеспечивающие выполнение репликации моментальных снимков и подробно описанные в предыдущем разделе. После того как схема таблицы будет применена на подписчике, можно копировать моментальный снимок. Таким образом, когда копирование завершится, будет создана стартовая точка для применения транзакций. Таблицы подписчика будут иметь структуру, аналогичную структуре таблиц издателя.</p>
        <p class="text-Poppins13">Если подписчик уже имеет таблицы с правильной структурой и данные уже были синхронизированы, при создании репликации транзакций можно указать, что выполнение первоначальной синхронизации не нужно, тогда Snapshot Agent не будет запускаться.</p>
        <p class="text-Poppins13">После того как первоначальная синхронизация выполнена, начинается копирование транзакций. Log Reader Agent запускается на дистрибьюторе и устанавливает соединение с издателем. Когда таблица участвует в репликации, все выполняемые в ней транзакции специальным образом маркируются для ускорения поиска нужных записей в журнале транзакций. Агент считывает только завершенные транзакции и сохраняет их в таблице MSrepl_transactions базы данных распределения Distribution.</p>
        <p class="text-Poppins13">Когда одна или несколько транзакций скопированы в базу данных распределения, Distribution Agent может начинать тиражировать их подписчикам. Агент последовательно считывает транзакции из таблицы MSrepl_transactions и применяет их на подписчиках в том же порядке, в котором они происходили на издателе. Тем самым гарантируется, что все подписчики будут иметь одинаковые копии данных.</p>
    </main>
    <footer>

    </footer>
</body>
<script src="../js/back.js"></script>
</html>